require.config({baseUrl:"js",paths:{avalon:"fb_lib/avalon.shim",echarts:"fb_lib/echarts",domReady:"fb_lib/domReady"},map:{"*":{css:"fb_lib/require.css",text:"fb_lib/require.text"}},shim:{avalon:{exports:"avalon"},echarts:{exports:"echarts"}}});require(["project.core","./fb_lib/simplegrid/avalon.simplegrid","domReady!"],function(fb,a){function initGeos(json,name){vm.addressName="china"==name?"全国":name;geoCoordMap={};geos=[];commSeries[0].map=name;var series=commSeries.slice();seriesMap[name]&&(series=series.concat(seriesMap[name]));option.series=series;var legends=commLegend.slice();legendMap[name]&&(legends=legends.concat(legendMap[name]));option.legend.data=legends;option.geo.map=name;echarts.registerMap(name,json);mapModel=json;for(var p in mapModel.features){geoCoordMap[mapModel.features[p].properties.name]=mapModel.features[p].properties.cp;geos.push(mapModel.features[p].properties.name)}for(var j=0;3>j;j++)option.series[j+1].data=[]}function readData(){for(var il=Math.round(20*Math.random()),i=0;il>i;i++){count++;var j=Math.round(2*Math.random()),data=commSeries[j+1].data,fromIdx=Math.round(Math.random()*(geos.length-1)),toIdx=Math.round(Math.random()*(geos.length-1)),from=geos[fromIdx],to=geos[toIdx],value=Math.round(1e3*Math.random());if(from!=to){data.length>20&&data.shift();data.push([{name:from+count,coord:geoCoordMap[from],value:[value,0,count]},{name:j+"_"+from+"_"+to+"_"+count,coord:geoCoordMap[to],value:[value,0,count]}]);vm.missles.length>20&&vm.missles.shift();vm.missles.push({from:from,to:to,value:value,color:color[j],series:commSeries[j+1].name})}}myChart.setOption(option)}var mapModel,timer,vm=avalon.define({$id:"mainCtl",firstWord:"Welcome!",prop:"",addressName:"全国",showBaseLine:!1,legendState:{"移动":!0,"联通":!0,"电信":!0},missles:[],contentHeight:0,readMapModel:function(name){avalon.ajax({url:"model/"+("china"==name?"china":nameMap[name])+".json",dataType:"json",success:function(json){initGeos(json,name);clearInterval(timer);readData();timer=setInterval(readData,3e3)}})},$simplegridAOpts:{useInnerRequest:!1,showRows:10,columns:[{field:"name",text:"地市",resizable:!0},{field:"yidong",text:"移动",resizable:!0},{field:"liantong",text:"联通",resizable:!0},{field:"dianxin",text:"电信",resizable:!0}],data:[]}}),planePath="path://M1705.06,1318.313L-102.4,-4.5Q104.2,-4.5,105.6,-3.2Q106.9,-1.8,106.9,0Q106.9,1.8,105.6,3.2Q104.2,4.5,102.4,4.5z",color=["#77CA4A","#00FFFC","#D90500"],commSeries=[{name:"map1",type:"map",zlevel:1,mapType:"china",label:{normal:{show:!1},emphasis:{show:!0,textStyle:{color:"#fff"}}},data:[],selectedMode:!0,itemStyle:{normal:{areaColor:"#0D6B90",borderColor:"#59A6BD",opacity:.7}}},{name:"移动",type:"missles",zlevel:3,effect:{show:!0,period:3,trailLength:0,symbol:planePath,symbolSize:30,loop:!1,bombSize:60,color:color[0],showBaseLine:vm.showBaseLine},lineStyle:{normal:{color:color[0],width:1,opacity:.4,curveness:.2}},data:[]},{name:"联通",type:"missles",zlevel:4,effect:{show:!0,period:3,trailLength:0,symbol:planePath,symbolSize:30,loop:!1,bombSize:60,color:color[1],showBaseLine:vm.showBaseLine},lineStyle:{normal:{color:color[1],width:1,opacity:.4,curveness:.2}},data:[]},{name:"电信",type:"missles",zlevel:5,effect:{show:!0,period:3,trailLength:0,symbol:planePath,symbolSize:30,loop:!1,bombSize:60,color:color[2],showBaseLine:vm.showBaseLine},lineStyle:{normal:{color:color[2],width:1,opacity:.4,curveness:.2}},data:[]}],seriesMap={"四川":[{type:"scatter",name:"安讯机房",coordinateSystem:"geo",symbolSize:12,zlevel:5,label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{normal:{color:"#FF6612",opacity:1},emphasis:{borderColor:"#fff",borderWidth:1}},data:[{name:"安讯机房",value:[105.571331,30.513311,200]}]},{type:"scatter",name:"四川省厅",coordinateSystem:"geo",symbolSize:12,zlevel:6,label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{normal:{color:"#F6FF00"},emphasis:{borderColor:"#fff",borderWidth:1}},data:[{name:"四川省厅",value:[104.398651,31.127991,200]}]},{type:"scatter",name:"成都市局",coordinateSystem:"geo",symbolSize:12,zlevel:7,label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{normal:{color:"#0FF2FA"},emphasis:{borderColor:"#fff",borderWidth:1}},data:[{name:"成都市局",value:[104.741722,31.46402,200]}]}]},commLegend=[{name:"移动",icon:planePath},{name:"联通",icon:planePath},{name:"电信",icon:planePath}],legendMap={"四川":[{name:"安讯机房",icon:"circle"},{name:"四川省厅",icon:"circle"},{name:"成都市局",icon:"circle"}]},option={title:{left:"center",textStyle:{color:"#fff"}},tooltip:{trigger:"item",show:!1},legend:{orient:"vertical",top:40,left:20,data:[],textStyle:{color:"#fff"},selectedMode:"multiple",selected:vm.legendState},geo:{map:"china",label:{emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"#323c48",borderColor:"#404a59",opacity:0},emphasis:{areaColor:"#2a333d"}},scaleLimit:{min:1,max:1}},series:[]},geoCoordMap={},geos=[],nameMap={"安徽":"anhui","澳门":"aomen","北京":"beijing","中国":"china","重庆":"chongqing","福建":"fujian","甘肃":"gansu","广东":"guangdong","广西":"guangxi","贵州":"guizhou","海南":"hainan","河北":"hebei","黑龙江":"heilongjiang","河南":"henan","湖北":"hubei","湖南":"hunan","江苏":"jiangsu","江西":"jiangxi","吉林":"jilin","辽宁":"liaoning","内蒙古":"neimenggu","宁夏":"ningxia","青海":"qinghai","山东":"shandong","上海":"shanghai","四川":"sichuan","天津":"tianjin","香港":"xianggang","新疆":"xinjiang","西藏":"xizang","云南":"yunnan","浙江":"zhejiang"},myChart=echarts.init(document.getElementById("map")),count=1;myChart.on("mapselectchanged",function(info){nameMap[info.name]&&vm.readMapModel(info.name)});myChart.on("legendselectchanged",function(info){console.log(info);option.legend.selected=info.selected;vm.legendState=option.legend.selected});window.onresize=function(){myChart.resize()};fb.requestJson({remoteUrl:"model/Three.json",localUrl:"model/Three.json",success:function(data){vm.$simplegridAOpts.data=data;$("#dbTable").show();$(".header").show();avalon.scan();vm.readMapModel("china")}})});