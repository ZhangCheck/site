define([],function(){function convertURIBase(uri,fromBase,toBase){if(uri.match(absUrlRegEx)||uri.match(protocolRegEx))return uri;uri=removeDoubleSlashes(uri);var toBaseProtocol=toBase.match(protocolRegEx),fromBaseProtocol=fromBase.match(protocolRegEx);return!fromBaseProtocol||toBaseProtocol&&toBaseProtocol[1]==fromBaseProtocol[1]&&toBaseProtocol[2]==fromBaseProtocol[2]?relativeURI(absoluteURI(uri,fromBase),toBase):absoluteURI(uri,fromBase)}function absoluteURI(uri,base){"./"==uri.substr(0,2)&&(uri=uri.substr(2));if(uri.match(absUrlRegEx)||uri.match(protocolRegEx))return uri;var baseParts=base.split("/"),uriParts=uri.split("/");baseParts.pop();for(;curPart=uriParts.shift();)".."==curPart?baseParts.pop():baseParts.push(curPart);return baseParts.join("/")}function relativeURI(uri,base){var baseParts=base.split("/");baseParts.pop();base=baseParts.join("/")+"/";i=0;for(;base.substr(i,1)==uri.substr(i,1);)i++;for(;"/"!=base.substr(i,1);)i--;base=base.substr(i+1);uri=uri.substr(i+1);baseParts=base.split("/");var uriParts=uri.split("/");out="";for(;baseParts.shift();)out+="../";for(;curPart=uriParts.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var slashes=/([^:])\/+/g,removeDoubleSlashes=function(uri){return uri.replace(slashes,"$1/")},protocolRegEx=/[^\:\/]*:\/\/([^\/])*/,absUrlRegEx=/^(\/|data:)/,normalizeCSS=function(source,fromBase,toBase){fromBase=removeDoubleSlashes(fromBase);toBase=removeDoubleSlashes(toBase);for(var result,url,source,urlRegEx=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;result=urlRegEx.exec(source);){url=result[3]||result[2]||result[5]||result[6]||result[4];var newUrl;newUrl=convertURIBase(url,fromBase,toBase);var quoteLen=result[5]||result[6]?1:0;source=source.substr(0,urlRegEx.lastIndex-url.length-quoteLen-1)+newUrl+source.substr(urlRegEx.lastIndex-quoteLen-1);urlRegEx.lastIndex=urlRegEx.lastIndex+(newUrl.length-url.length)}return source};normalizeCSS.convertURIBase=convertURIBase;normalizeCSS.absoluteURI=absoluteURI;normalizeCSS.relativeURI=relativeURI;return normalizeCSS});