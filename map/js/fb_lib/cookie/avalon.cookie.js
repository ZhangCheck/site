define(["avalon"],function(){function parseCookieValue(s){0===s.indexOf('"')&&(s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return decodeURIComponent(s.replace(/\+/g," "))}catch(e){return s}}var Cookie={stringify:function(name,val,opts){var pairs=[name+"="+encodeURIComponent(val)];if(isFinite(opts)&&"number"==typeof opts)pairs.push("Max-Age="+opts);else{opts=opts||{};opts.maxAge&&pairs.push("Max-Age="+opts.maxAge);opts.domain&&pairs.push("Domain="+opts.domain);opts.path&&pairs.push("Path="+opts.path);opts.expires&&pairs.push("Expires="+opts.expires.toUTCString());opts.httpOnly&&pairs.push("HttpOnly");opts.secure&&pairs.push("Secure")}return pairs.join("; ")},forEach:function(callback){var pairs=String(document.cookie).split(/; */);pairs.forEach(function(pair){var index=pair.indexOf("=");if(-1!==index){var key=pair.substr(0,index).trim(),val=pair.substr(++index,pair.length).trim();callback(key,parseCookieValue(val))}})},get:function(name,def){var ret;try{Cookie.forEach(function(key,value){if(key===name){ret=value;throw""}})}catch(e){}return void 0===ret?def:ret},getAll:function(){var obj={};Cookie.forEach(function(key,value){key in obj||(obj[key]=value)});return obj},set:function(key,val,opts){document.cookie=Cookie.stringify.apply(0,arguments)},remove:function(key,opt){opt=opt||{};opt.expires||(opt.expires=new Date(1970,0,1));Cookie.set(key,"",opt)},clear:function(){Cookie.forEach(function(key,value){Cookie.remove(key)})}};avalon.cookie=Cookie;return avalon});