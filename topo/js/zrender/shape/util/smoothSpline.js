define(["require","../../tool/vector"],function(require){function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=.5*(p2-p0),v1=.5*(p3-p1);return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}var vector=require("../../tool/vector");return function(points,isLoop,constraint){for(var len=points.length,ret=[],distance=0,i=1;len>i;i++)distance+=vector.distance(points[i-1],points[i]);var segs=distance/5;segs=len>segs?len:segs;for(var i=0;segs>i;i++){var p0,p2,p3,pos=i/(segs-1)*(isLoop?len:len-1),idx=Math.floor(pos),w=pos-idx,p1=points[idx%len];if(isLoop){p0=points[(idx-1+len)%len];p2=points[(idx+1)%len];p3=points[(idx+2)%len]}else{p0=points[0===idx?idx:idx-1];p2=points[idx>len-2?len-1:idx+1];p3=points[idx>len-3?len-1:idx+2]}var w2=w*w,w3=w*w2;ret.push([interpolate(p0[0],p1[0],p2[0],p3[0],w,w2,w3),interpolate(p0[1],p1[1],p2[1],p3[1],w,w2,w3)])}return ret}});