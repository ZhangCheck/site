define(["require","../tool/util"],function(require){function customPalette(userPalete){palette=userPalete}function resetPalette(){palette=_palette}function getColor(idx,userPalete){idx=0|idx;userPalete=userPalete||palette;return userPalete[idx%userPalete.length]}function customHighlight(userHighlightColor){highlightColor=userHighlightColor}function resetHighlight(){_highlightColor=highlightColor}function getHighlightColor(){return highlightColor}function getRadialGradient(x0,y0,r0,x1,y1,r1,colorList){_ctx||(_ctx=util.getContext());for(var gradient=_ctx.createRadialGradient(x0,y0,r0,x1,y1,r1),i=0,l=colorList.length;l>i;i++)gradient.addColorStop(colorList[i][0],colorList[i][1]);gradient.__nonRecursion=!0;return gradient}function getLinearGradient(x0,y0,x1,y1,colorList){_ctx||(_ctx=util.getContext());for(var gradient=_ctx.createLinearGradient(x0,y0,x1,y1),i=0,l=colorList.length;l>i;i++)gradient.addColorStop(colorList[i][0],colorList[i][1]);gradient.__nonRecursion=!0;return gradient}function getStepColors(start,end,step){start=toRGBA(start);end=toRGBA(end);start=getData(start);end=getData(end);for(var colors=[],stepR=(end[0]-start[0])/step,stepG=(end[1]-start[1])/step,stepB=(end[2]-start[2])/step,stepA=(end[3]-start[3])/step,i=0,r=start[0],g=start[1],b=start[2],a=start[3];step>i;i++){colors[i]=toColor([adjust(Math.floor(r),[0,255]),adjust(Math.floor(g),[0,255]),adjust(Math.floor(b),[0,255]),a.toFixed(4)-0],"rgba");r+=stepR;g+=stepG;b+=stepB;a+=stepA}r=end[0];g=end[1];b=end[2];a=end[3];colors[i]=toColor([r,g,b,a],"rgba");return colors}function getGradientColors(colors,step){var ret=[],len=colors.length;void 0===step&&(step=20);if(1===len)ret=getStepColors(colors[0],colors[0],step);else if(len>1)for(var i=0,n=len-1;n>i;i++){var steps=getStepColors(colors[i],colors[i+1],step);n-1>i&&steps.pop();ret=ret.concat(steps)}return ret}function toColor(data,format){format=format||"rgb";if(data&&(3===data.length||4===data.length)){data=map(data,function(c){return c>1?Math.ceil(c):c});if(format.indexOf("hex")>-1)return"#"+((1<<24)+(data[0]<<16)+(data[1]<<8)+ +data[2]).toString(16).slice(1);if(format.indexOf("hs")>-1){var sx=map(data.slice(1,3),function(c){return c+"%"});data[1]=sx[0];data[2]=sx[1]}if(format.indexOf("a")>-1){3===data.length&&data.push(1);data[3]=adjust(data[3],[0,1]);return format+"("+data.slice(0,4).join(",")+")"}return format+"("+data.slice(0,3).join(",")+")"}}function toArray(color){color=trim(color);color.indexOf("rgba")<0&&(color=toRGBA(color));var data=[],i=0;color.replace(/[\d.]+/g,function(n){n=3>i?0|n:+n;data[i++]=n});return data}function convert(color,format){if(!isCalculableColor(color))return color;var data=getData(color),alpha=data[3];"undefined"==typeof alpha&&(alpha=1);color.indexOf("hsb")>-1?data=_HSV_2_RGB(data):color.indexOf("hsl")>-1&&(data=_HSL_2_RGB(data));format.indexOf("hsb")>-1||format.indexOf("hsv")>-1?data=_RGB_2_HSB(data):format.indexOf("hsl")>-1&&(data=_RGB_2_HSL(data));data[3]=alpha;return toColor(data,format)}function toRGBA(color){return convert(color,"rgba")}function toRGB(color){return convert(color,"rgb")}function toHex(color){return convert(color,"hex")}function toHSVA(color){return convert(color,"hsva")}function toHSV(color){return convert(color,"hsv")}function toHSBA(color){return convert(color,"hsba")}function toHSB(color){return convert(color,"hsb")}function toHSLA(color){return convert(color,"hsla")}function toHSL(color){return convert(color,"hsl")}function toName(color){for(var key in _nameColors)if(toHex(_nameColors[key])===toHex(color))return key;return null}function trim(color){return String(color).replace(/\s+/g,"")}function normalize(color){_nameColors[color]&&(color=_nameColors[color]);color=trim(color);color=color.replace(/hsv/i,"hsb");if(/^#[\da-f]{3}$/i.test(color)){color=parseInt(color.slice(1),16);var r=(3840&color)<<8,g=(240&color)<<4,b=15&color;color="#"+((1<<24)+(r<<4)+r+(g<<4)+g+(b<<4)+b).toString(16).slice(1)}return color}function lift(color,level){if(!isCalculableColor(color))return color;var direct=level>0?1:-1;"undefined"==typeof level&&(level=0);level=Math.abs(level)>1?1:Math.abs(level);color=toRGB(color);for(var data=getData(color),i=0;3>i;i++)1===direct?data[i]=data[i]*(1-level)|0:data[i]=(255-data[i])*level+data[i]|0;return"rgb("+data.join(",")+")"}function reverse(color){if(!isCalculableColor(color))return color;var data=getData(toRGBA(color));data=map(data,function(c){return 255-c});return toColor(data,"rgb")}function mix(color1,color2,weight){if(!isCalculableColor(color1)||!isCalculableColor(color2))return color1;"undefined"==typeof weight&&(weight=.5);weight=1-adjust(weight,[0,1]);for(var w=2*weight-1,data1=getData(toRGBA(color1)),data2=getData(toRGBA(color2)),d=data1[3]-data2[3],weight1=((w*d===-1?w:(w+d)/(1+w*d))+1)/2,weight2=1-weight1,data=[],i=0;3>i;i++)data[i]=data1[i]*weight1+data2[i]*weight2;var alpha=data1[3]*weight+data2[3]*(1-weight);alpha=Math.max(0,Math.min(1,alpha));if(1===data1[3]&&1===data2[3])return toColor(data,"rgb");data[3]=alpha;return toColor(data,"rgba")}function random(){return"#"+(Math.random().toString(16)+"0000").slice(2,8)}function getData(color){color=normalize(color);var r=color.match(colorRegExp);if(null===r)throw new Error("The color format error");var d,a,rgb,data=[];if(r[2]){d=r[2].replace("#","").split("");rgb=[d[0]+d[1],d[2]+d[3],d[4]+d[5]];data=map(rgb,function(c){return adjust(parseInt(c,16),[0,255])})}else if(r[4]){var rgba=r[4].split(",");a=rgba[3];rgb=rgba.slice(0,3);data=map(rgb,function(c){c=Math.floor(c.indexOf("%")>0?2.55*parseInt(c,0):c);return adjust(c,[0,255])});"undefined"!=typeof a&&data.push(adjust(parseFloat(a),[0,1]))}else if(r[5]||r[6]){var hsxa=(r[5]||r[6]).split(","),h=parseInt(hsxa[0],0)/360,s=hsxa[1],x=hsxa[2];a=hsxa[3];data=map([s,x],function(c){return adjust(parseFloat(c)/100,[0,1])});data.unshift(h);"undefined"!=typeof a&&data.push(adjust(parseFloat(a),[0,1]))}return data}function alpha(color,a){if(!isCalculableColor(color))return color;null===a&&(a=1);var data=getData(toRGBA(color));data[3]=adjust(Number(a).toFixed(4),[0,1]);return toColor(data,"rgba")}function map(array,fun){if("function"!=typeof fun)throw new TypeError;for(var len=array?array.length:0,i=0;len>i;i++)array[i]=fun(array[i]);return array}function adjust(value,region){value<=region[0]?value=region[0]:value>=region[1]&&(value=region[1]);return value}function isCalculableColor(color){return color instanceof Array||"string"==typeof color}function _HSV_2_RGB(data){var R,G,B,H=data[0],S=data[1],V=data[2];if(0===S){R=255*V;G=255*V;B=255*V}else{var h=6*H;6===h&&(h=0);var i=0|h,v1=V*(1-S),v2=V*(1-S*(h-i)),v3=V*(1-S*(1-(h-i))),r=0,g=0,b=0;if(0===i){r=V;g=v3;b=v1}else if(1===i){r=v2;g=V;b=v1}else if(2===i){r=v1;g=V;b=v3}else if(3===i){r=v1;g=v2;b=V}else if(4===i){r=v3;g=v1;b=V}else{r=V;g=v1;b=v2}R=255*r;G=255*g;B=255*b}return[R,G,B]}function _HSL_2_RGB(data){var R,G,B,H=data[0],S=data[1],L=data[2];if(0===S){R=255*L;G=255*L;B=255*L}else{var v2;v2=.5>L?L*(1+S):L+S-S*L;var v1=2*L-v2;R=255*_HUE_2_RGB(v1,v2,H+1/3);G=255*_HUE_2_RGB(v1,v2,H);B=255*_HUE_2_RGB(v1,v2,H-1/3)}return[R,G,B]}function _HUE_2_RGB(v1,v2,vH){0>vH&&(vH+=1);vH>1&&(vH-=1);return 1>6*vH?v1+6*(v2-v1)*vH:1>2*vH?v2:2>3*vH?v1+(v2-v1)*(2/3-vH)*6:v1}function _RGB_2_HSB(data){var H,S,R=data[0]/255,G=data[1]/255,B=data[2]/255,vMin=Math.min(R,G,B),vMax=Math.max(R,G,B),delta=vMax-vMin,V=vMax;if(0===delta){H=0;S=0}else{S=delta/vMax;var deltaR=((vMax-R)/6+delta/2)/delta,deltaG=((vMax-G)/6+delta/2)/delta,deltaB=((vMax-B)/6+delta/2)/delta;R===vMax?H=deltaB-deltaG:G===vMax?H=1/3+deltaR-deltaB:B===vMax&&(H=2/3+deltaG-deltaR);0>H&&(H+=1);H>1&&(H-=1)}H=360*H;S=100*S;V=100*V;return[H,S,V]}function _RGB_2_HSL(data){var H,S,R=data[0]/255,G=data[1]/255,B=data[2]/255,vMin=Math.min(R,G,B),vMax=Math.max(R,G,B),delta=vMax-vMin,L=(vMax+vMin)/2;if(0===delta){H=0;S=0}else{S=.5>L?delta/(vMax+vMin):delta/(2-vMax-vMin);var deltaR=((vMax-R)/6+delta/2)/delta,deltaG=((vMax-G)/6+delta/2)/delta,deltaB=((vMax-B)/6+delta/2)/delta;R===vMax?H=deltaB-deltaG:G===vMax?H=1/3+deltaR-deltaB:B===vMax&&(H=2/3+deltaG-deltaR);0>H&&(H+=1);H>1&&(H-=1)}H=360*H;S=100*S;L=100*L;return[H,S,L]}var _ctx,util=require("../tool/util"),palette=["#ff9277"," #dddd00"," #ffc877"," #bbe3ff"," #d5ffbb","#bbbbff"," #ddb000"," #b0dd00"," #e2bbff"," #ffbbe3","#ff7777"," #ff9900"," #83dd00"," #77e3ff"," #778fff","#c877ff"," #ff77ab"," #ff6600"," #aa8800"," #77c7ff","#ad77ff"," #ff77ff"," #dd0083"," #777700"," #00aa00","#0088aa"," #8400dd"," #aa0088"," #dd0000"," #772e00"],_palette=palette,highlightColor="rgba(255,255,0,0.5)",_highlightColor=highlightColor,colorRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,_nameColors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#0ff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000",blanchedalmond:"#ffebcd",blue:"#00f",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#f0f",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#0f0",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#f0f",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#f00",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#fff",whitesmoke:"#f5f5f5",yellow:"#ff0",yellowgreen:"#9acd32"};return{customPalette:customPalette,resetPalette:resetPalette,getColor:getColor,getHighlightColor:getHighlightColor,customHighlight:customHighlight,resetHighlight:resetHighlight,getRadialGradient:getRadialGradient,getLinearGradient:getLinearGradient,getGradientColors:getGradientColors,getStepColors:getStepColors,reverse:reverse,mix:mix,lift:lift,trim:trim,random:random,toRGB:toRGB,toRGBA:toRGBA,toHex:toHex,toHSL:toHSL,toHSLA:toHSLA,toHSB:toHSB,toHSBA:toHSBA,toHSV:toHSV,toHSVA:toHSVA,toName:toName,toColor:toColor,toArray:toArray,alpha:alpha,getData:getData}});