define(["require","./base","zrender/shape/Rectangle","zrender/shape/Polygon","../util/shape/Icon","../config","../util/date","zrender/tool/util","../component","../component"],function(require){function DataZoom(ecTheme,messageCenter,zr,option,myChart){Base.call(this,ecTheme,messageCenter,zr,option,myChart);var self=this;self._ondrift=function(dx,dy){return self.__ondrift(this,dx,dy)};self._ondragend=function(){return self.__ondragend()};this._fillerSize=30;this._isSilence=!1;this._zoom={};this.option.dataZoom=this.reformOption(this.option.dataZoom);this.zoomOption=this.option.dataZoom;this._handleSize=this.zoomOption.handleSize;this.myChart.canvasSupported||(this.zoomOption.realtime=!1);this._location=this._getLocation();this._zoom=this._getZoom();this._backupData();this.option.dataZoom.show&&this._buildShape();this._syncData()}var Base=require("./base"),RectangleShape=require("zrender/shape/Rectangle"),PolygonShape=require("zrender/shape/Polygon"),IconShape=require("../util/shape/Icon"),ecConfig=require("../config");ecConfig.dataZoom={zlevel:0,z:4,show:!1,orient:"horizontal",backgroundColor:"rgba(0,0,0,0)",dataBackgroundColor:"#eee",fillerColor:"rgba(144,197,237,0.2)",handleColor:"rgba(70,130,180,0.8)",handleSize:8,showDetail:!0,realtime:!0};var ecDate=require("../util/date"),zrUtil=require("zrender/tool/util");DataZoom.prototype={type:ecConfig.COMPONENT_TYPE_DATAZOOM,_buildShape:function(){this._buildBackground();this._buildFiller();this._buildHandle();this._buildFrame();for(var i=0,l=this.shapeList.length;l>i;i++)this.zr.addShape(this.shapeList[i]);this._syncFrameShape()},_getLocation:function(){var x,y,width,height,grid=this.component.grid;if("horizontal"==this.zoomOption.orient){width=this.zoomOption.width||grid.getWidth();height=this.zoomOption.height||this._fillerSize;x=null!=this.zoomOption.x?this.zoomOption.x:grid.getX();y=null!=this.zoomOption.y?this.zoomOption.y:this.zr.getHeight()-height-2}else{width=this.zoomOption.width||this._fillerSize;height=this.zoomOption.height||grid.getHeight();x=null!=this.zoomOption.x?this.zoomOption.x:2;y=null!=this.zoomOption.y?this.zoomOption.y:grid.getY()}return{x:x,y:y,width:width,height:height}},_getZoom:function(){var series=this.option.series,xAxis=this.option.xAxis;if(xAxis&&!(xAxis instanceof Array)){xAxis=[xAxis];this.option.xAxis=xAxis}var yAxis=this.option.yAxis;if(yAxis&&!(yAxis instanceof Array)){yAxis=[yAxis];this.option.yAxis=yAxis}var xAxisIndex,yAxisIndex,zoomSeriesIndex=[],zOptIdx=this.zoomOption.xAxisIndex;if(xAxis&&null==zOptIdx){xAxisIndex=[];for(var i=0,l=xAxis.length;l>i;i++)("category"==xAxis[i].type||null==xAxis[i].type)&&xAxisIndex.push(i)}else xAxisIndex=zOptIdx instanceof Array?zOptIdx:null!=zOptIdx?[zOptIdx]:[];zOptIdx=this.zoomOption.yAxisIndex;if(yAxis&&null==zOptIdx){yAxisIndex=[];for(var i=0,l=yAxis.length;l>i;i++)"category"==yAxis[i].type&&yAxisIndex.push(i)}else yAxisIndex=zOptIdx instanceof Array?zOptIdx:null!=zOptIdx?[zOptIdx]:[];for(var serie,i=0,l=series.length;l>i;i++){serie=series[i];if(serie.type==ecConfig.CHART_TYPE_LINE||serie.type==ecConfig.CHART_TYPE_BAR||serie.type==ecConfig.CHART_TYPE_SCATTER||serie.type==ecConfig.CHART_TYPE_K){for(var j=0,k=xAxisIndex.length;k>j;j++)if(xAxisIndex[j]==(serie.xAxisIndex||0)){zoomSeriesIndex.push(i);break}for(var j=0,k=yAxisIndex.length;k>j;j++)if(yAxisIndex[j]==(serie.yAxisIndex||0)){zoomSeriesIndex.push(i);break}null==this.zoomOption.xAxisIndex&&null==this.zoomOption.yAxisIndex&&serie.data&&this.getDataFromOption(serie.data[0])instanceof Array&&(serie.type==ecConfig.CHART_TYPE_SCATTER||serie.type==ecConfig.CHART_TYPE_LINE||serie.type==ecConfig.CHART_TYPE_BAR)&&zoomSeriesIndex.push(i)}}var start=null!=this._zoom.start?this._zoom.start:null!=this.zoomOption.start?this.zoomOption.start:0,end=null!=this._zoom.end?this._zoom.end:null!=this.zoomOption.end?this.zoomOption.end:100;if(start>end){start+=end;end=start-end;start-=end}var size=Math.round((end-start)/100*("horizontal"==this.zoomOption.orient?this._location.width:this._location.height));return{start:start,end:end,start2:0,end2:100,size:size,xAxisIndex:xAxisIndex,yAxisIndex:yAxisIndex,seriesIndex:zoomSeriesIndex,scatterMap:this._zoom.scatterMap||{}}},_backupData:function(){this._originalData={xAxis:{},yAxis:{},series:{}};for(var xAxis=this.option.xAxis,xAxisIndex=this._zoom.xAxisIndex,i=0,l=xAxisIndex.length;l>i;i++)this._originalData.xAxis[xAxisIndex[i]]=xAxis[xAxisIndex[i]].data;for(var yAxis=this.option.yAxis,yAxisIndex=this._zoom.yAxisIndex,i=0,l=yAxisIndex.length;l>i;i++)this._originalData.yAxis[yAxisIndex[i]]=yAxis[yAxisIndex[i]].data;for(var serie,series=this.option.series,seriesIndex=this._zoom.seriesIndex,i=0,l=seriesIndex.length;l>i;i++){serie=series[seriesIndex[i]];this._originalData.series[seriesIndex[i]]=serie.data;if(serie.data&&this.getDataFromOption(serie.data[0])instanceof Array&&(serie.type==ecConfig.CHART_TYPE_SCATTER||serie.type==ecConfig.CHART_TYPE_LINE||serie.type==ecConfig.CHART_TYPE_BAR)){this._backupScale();this._calculScatterMap(seriesIndex[i])}}},_calculScatterMap:function(seriesIndex){this._zoom.scatterMap=this._zoom.scatterMap||{};this._zoom.scatterMap[seriesIndex]=this._zoom.scatterMap[seriesIndex]||{};var componentLibrary=require("../component"),Axis=componentLibrary.get("axis"),axisOption=zrUtil.clone(this.option.xAxis);"category"==axisOption[0].type&&(axisOption[0].type="value");axisOption[1]&&"category"==axisOption[1].type&&(axisOption[1].type="value");var vAxis=new Axis(this.ecTheme,null,!1,{xAxis:axisOption,series:this.option.series},this,"xAxis"),axisIndex=this.option.series[seriesIndex].xAxisIndex||0;this._zoom.scatterMap[seriesIndex].x=vAxis.getAxis(axisIndex).getExtremum();vAxis.dispose();axisOption=zrUtil.clone(this.option.yAxis);"category"==axisOption[0].type&&(axisOption[0].type="value");axisOption[1]&&"category"==axisOption[1].type&&(axisOption[1].type="value");vAxis=new Axis(this.ecTheme,null,!1,{yAxis:axisOption,series:this.option.series},this,"yAxis");axisIndex=this.option.series[seriesIndex].yAxisIndex||0;this._zoom.scatterMap[seriesIndex].y=vAxis.getAxis(axisIndex).getExtremum();vAxis.dispose()},_buildBackground:function(){var width=this._location.width,height=this._location.height;this.shapeList.push(new RectangleShape({zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:this._location.x,y:this._location.y,width:width,height:height,color:this.zoomOption.backgroundColor}}));for(var maxLength=0,xAxis=this._originalData.xAxis,xAxisIndex=this._zoom.xAxisIndex,i=0,l=xAxisIndex.length;l>i;i++)maxLength=Math.max(maxLength,xAxis[xAxisIndex[i]].length);for(var yAxis=this._originalData.yAxis,yAxisIndex=this._zoom.yAxisIndex,i=0,l=yAxisIndex.length;l>i;i++)maxLength=Math.max(maxLength,yAxis[yAxisIndex[i]].length);for(var value,seriesIndex=this._zoom.seriesIndex[0],data=this._originalData.series[seriesIndex],maxValue=Number.MIN_VALUE,minValue=Number.MAX_VALUE,i=0,l=data.length;l>i;i++){value=this.getDataFromOption(data[i],0);this.option.series[seriesIndex].type==ecConfig.CHART_TYPE_K&&(value=value[1]);isNaN(value)&&(value=0);maxValue=Math.max(maxValue,value);minValue=Math.min(minValue,value)}var valueRange=maxValue-minValue,pointList=[],x=width/(maxLength-(maxLength>1?1:0)),y=height/(maxLength-(maxLength>1?1:0)),step=1;"horizontal"==this.zoomOption.orient&&1>x?step=Math.floor(3*maxLength/width):"vertical"==this.zoomOption.orient&&1>y&&(step=Math.floor(3*maxLength/height));for(var i=0,l=maxLength;l>i;i+=step){value=this.getDataFromOption(data[i],0);this.option.series[seriesIndex].type==ecConfig.CHART_TYPE_K&&(value=value[1]);isNaN(value)&&(value=0);"horizontal"==this.zoomOption.orient?pointList.push([this._location.x+x*i,this._location.y+height-1-Math.round((value-minValue)/valueRange*(height-10))]):pointList.push([this._location.x+1+Math.round((value-minValue)/valueRange*(width-10)),this._location.y+y*(l-i-1)])}if("horizontal"==this.zoomOption.orient){pointList.push([this._location.x+width,this._location.y+height]);pointList.push([this._location.x,this._location.y+height])}else{pointList.push([this._location.x,this._location.y]);pointList.push([this._location.x,this._location.y+height])}this.shapeList.push(new PolygonShape({zlevel:this.getZlevelBase(),z:this.getZBase(),style:{pointList:pointList,color:this.zoomOption.dataBackgroundColor},hoverable:!1}))},_buildFiller:function(){this._fillerShae={zlevel:this.getZlevelBase(),z:this.getZBase(),draggable:!0,ondrift:this._ondrift,ondragend:this._ondragend,_type:"filler"};"horizontal"==this.zoomOption.orient?this._fillerShae.style={x:this._location.x+Math.round(this._zoom.start/100*this._location.width)+this._handleSize,y:this._location.y,width:this._zoom.size-2*this._handleSize,height:this._location.height,color:this.zoomOption.fillerColor,text:":::",textPosition:"inside"}:this._fillerShae.style={x:this._location.x,y:this._location.y+Math.round(this._zoom.start/100*this._location.height)+this._handleSize,width:this._location.width,height:this._zoom.size-2*this._handleSize,color:this.zoomOption.fillerColor,text:"::",textPosition:"inside"};this._fillerShae.highlightStyle={brushType:"fill",color:"rgba(0,0,0,0)"};this._fillerShae=new RectangleShape(this._fillerShae);this.shapeList.push(this._fillerShae)},_buildHandle:function(){var detail=this.zoomOption.showDetail?this._getDetail():{start:"",end:""};this._startShape={zlevel:this.getZlevelBase(),z:this.getZBase(),draggable:!0,style:{iconType:"rectangle",x:this._location.x,y:this._location.y,width:this._handleSize,height:this._handleSize,color:this.zoomOption.handleColor,text:"=",textPosition:"inside"},highlightStyle:{text:detail.start,brushType:"fill",textPosition:"left"},ondrift:this._ondrift,ondragend:this._ondragend};if("horizontal"==this.zoomOption.orient){this._startShape.style.height=this._location.height;this._endShape=zrUtil.clone(this._startShape);this._startShape.style.x=this._fillerShae.style.x-this._handleSize,this._endShape.style.x=this._fillerShae.style.x+this._fillerShae.style.width;this._endShape.highlightStyle.text=detail.end;this._endShape.highlightStyle.textPosition="right"}else{this._startShape.style.width=this._location.width;this._endShape=zrUtil.clone(this._startShape);this._startShape.style.y=this._fillerShae.style.y+this._fillerShae.style.height;this._startShape.highlightStyle.textPosition="bottom";this._endShape.style.y=this._fillerShae.style.y-this._handleSize;this._endShape.highlightStyle.text=detail.end;this._endShape.highlightStyle.textPosition="top"}this._startShape=new IconShape(this._startShape);this._endShape=new IconShape(this._endShape);this.shapeList.push(this._startShape);this.shapeList.push(this._endShape)},_buildFrame:function(){var x=this.subPixelOptimize(this._location.x,1),y=this.subPixelOptimize(this._location.y,1);this._startFrameShape={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:x,y:y,width:this._location.width-(x>this._location.x?1:0),height:this._location.height-(y>this._location.y?1:0),lineWidth:1,brushType:"stroke",strokeColor:this.zoomOption.handleColor}};this._endFrameShape=zrUtil.clone(this._startFrameShape);this._startFrameShape=new RectangleShape(this._startFrameShape);this._endFrameShape=new RectangleShape(this._endFrameShape);this.shapeList.push(this._startFrameShape);this.shapeList.push(this._endFrameShape)},_syncHandleShape:function(){if("horizontal"==this.zoomOption.orient){this._startShape.style.x=this._fillerShae.style.x-this._handleSize;this._endShape.style.x=this._fillerShae.style.x+this._fillerShae.style.width;this._zoom.start=(this._startShape.style.x-this._location.x)/this._location.width*100;this._zoom.end=(this._endShape.style.x+this._handleSize-this._location.x)/this._location.width*100}else{this._startShape.style.y=this._fillerShae.style.y+this._fillerShae.style.height;this._endShape.style.y=this._fillerShae.style.y-this._handleSize;this._zoom.start=(this._location.y+this._location.height-this._startShape.style.y)/this._location.height*100;this._zoom.end=(this._location.y+this._location.height-this._endShape.style.y-this._handleSize)/this._location.height*100}this.zr.modShape(this._startShape.id);this.zr.modShape(this._endShape.id);this._syncFrameShape();this.zr.refreshNextFrame()},_syncFillerShape:function(){var a,b;if("horizontal"==this.zoomOption.orient){a=this._startShape.style.x;b=this._endShape.style.x;this._fillerShae.style.x=Math.min(a,b)+this._handleSize;this._fillerShae.style.width=Math.abs(a-b)-this._handleSize;this._zoom.start=(Math.min(a,b)-this._location.x)/this._location.width*100;this._zoom.end=(Math.max(a,b)+this._handleSize-this._location.x)/this._location.width*100}else{a=this._startShape.style.y;b=this._endShape.style.y;this._fillerShae.style.y=Math.min(a,b)+this._handleSize;this._fillerShae.style.height=Math.abs(a-b)-this._handleSize;this._zoom.start=(this._location.y+this._location.height-Math.max(a,b))/this._location.height*100;this._zoom.end=(this._location.y+this._location.height-Math.min(a,b)-this._handleSize)/this._location.height*100}this.zr.modShape(this._fillerShae.id);this._syncFrameShape();this.zr.refreshNextFrame()},_syncFrameShape:function(){if("horizontal"==this.zoomOption.orient){this._startFrameShape.style.width=this._fillerShae.style.x-this._location.x;this._endFrameShape.style.x=this._fillerShae.style.x+this._fillerShae.style.width;this._endFrameShape.style.width=this._location.x+this._location.width-this._endFrameShape.style.x}else{this._startFrameShape.style.y=this._fillerShae.style.y+this._fillerShae.style.height;this._startFrameShape.style.height=this._location.y+this._location.height-this._startFrameShape.style.y;this._endFrameShape.style.height=this._fillerShae.style.y-this._location.y}this.zr.modShape(this._startFrameShape.id);this.zr.modShape(this._endFrameShape.id)},_syncShape:function(){if(this.zoomOption.show){if("horizontal"==this.zoomOption.orient){this._startShape.style.x=this._location.x+this._zoom.start/100*this._location.width;this._endShape.style.x=this._location.x+this._zoom.end/100*this._location.width-this._handleSize;this._fillerShae.style.x=this._startShape.style.x+this._handleSize;this._fillerShae.style.width=this._endShape.style.x-this._startShape.style.x-this._handleSize}else{this._startShape.style.y=this._location.y+this._location.height-this._zoom.start/100*this._location.height;this._endShape.style.y=this._location.y+this._location.height-this._zoom.end/100*this._location.height-this._handleSize;this._fillerShae.style.y=this._endShape.style.y+this._handleSize;this._fillerShae.style.height=this._startShape.style.y-this._endShape.style.y-this._handleSize}this.zr.modShape(this._startShape.id);this.zr.modShape(this._endShape.id);this.zr.modShape(this._fillerShae.id);this._syncFrameShape();this.zr.refresh()}},_syncData:function(dispatchNow){var target,start,end,length,data;for(var key in this._originalData){target=this._originalData[key];for(var idx in target){data=target[idx];if(null!=data){length=data.length;start=Math.floor(this._zoom.start/100*length);end=Math.ceil(this._zoom.end/100*length);if(this.getDataFromOption(data[0])instanceof Array&&this.option[key][idx].type!=ecConfig.CHART_TYPE_K){this._setScale();this.option[key][idx].data=this._synScatterData(idx,data)}else this.option[key][idx].data=data.slice(start,end)}}}this._isSilence||!this.zoomOption.realtime&&!dispatchNow||this.messageCenter.dispatch(ecConfig.EVENT.DATA_ZOOM,null,{zoom:this._zoom},this.myChart)},_synScatterData:function(seriesIndex,data){if(0===this._zoom.start&&100==this._zoom.end&&0===this._zoom.start2&&100==this._zoom.end2)return data;var total,xStart,xEnd,yStart,yEnd,newData=[],scale=this._zoom.scatterMap[seriesIndex];if("horizontal"==this.zoomOption.orient){total=scale.x.max-scale.x.min;xStart=this._zoom.start/100*total+scale.x.min;xEnd=this._zoom.end/100*total+scale.x.min;total=scale.y.max-scale.y.min;yStart=this._zoom.start2/100*total+scale.y.min;yEnd=this._zoom.end2/100*total+scale.y.min}else{total=scale.x.max-scale.x.min;xStart=this._zoom.start2/100*total+scale.x.min;xEnd=this._zoom.end2/100*total+scale.x.min;total=scale.y.max-scale.y.min;yStart=this._zoom.start/100*total+scale.y.min;yEnd=this._zoom.end/100*total+scale.y.min}var dataMappingMethods;if(dataMappingMethods=scale.x.dataMappingMethods){xStart=dataMappingMethods.coord2Value(xStart);xEnd=dataMappingMethods.coord2Value(xEnd)}if(dataMappingMethods=scale.y.dataMappingMethods){yStart=dataMappingMethods.coord2Value(yStart);yEnd=dataMappingMethods.coord2Value(yEnd)}for(var value,i=0,l=data.length;l>i;i++){value=data[i].value||data[i];value[0]>=xStart&&value[0]<=xEnd&&value[1]>=yStart&&value[1]<=yEnd&&newData.push(data[i])}return newData},_setScale:function(){var needScale=0!==this._zoom.start||100!==this._zoom.end||0!==this._zoom.start2||100!==this._zoom.end2,axis={xAxis:this.option.xAxis,yAxis:this.option.yAxis};for(var key in axis)for(var i=0,l=axis[key].length;l>i;i++)axis[key][i].scale=needScale||axis[key][i]._scale},_backupScale:function(){var axis={xAxis:this.option.xAxis,yAxis:this.option.yAxis};for(var key in axis)for(var i=0,l=axis[key].length;l>i;i++)axis[key][i]._scale=axis[key][i].scale},_getDetail:function(){for(var key=["xAxis","yAxis"],i=0,l=key.length;l>i;i++){var target=this._originalData[key[i]];for(var idx in target){var data=target[idx];if(null!=data){var length=data.length,start=Math.floor(this._zoom.start/100*length),end=Math.ceil(this._zoom.end/100*length);end-=end>0?1:0;return{start:this.getDataFromOption(data[start]),end:this.getDataFromOption(data[end])}}}}key="horizontal"==this.zoomOption.orient?"xAxis":"yAxis";var seriesIndex=this._zoom.seriesIndex[0],axisIndex=this.option.series[seriesIndex][key+"Index"]||0,axisType=this.option[key][axisIndex].type,min=this._zoom.scatterMap[seriesIndex][key.charAt(0)].min,max=this._zoom.scatterMap[seriesIndex][key.charAt(0)].max,gap=max-min;if("value"==axisType)return{start:min+gap*this._zoom.start/100,end:min+gap*this._zoom.end/100};if("time"==axisType){max=min+gap*this._zoom.end/100;min+=gap*this._zoom.start/100;var formatter=ecDate.getAutoFormatter(min,max).formatter;return{start:ecDate.format(formatter,min),end:ecDate.format(formatter,max)}}return{start:"",end:""}},__ondrift:function(shape,dx,dy){this.zoomOption.zoomLock&&(shape=this._fillerShae);var detailSize="filler"==shape._type?this._handleSize:0;"horizontal"==this.zoomOption.orient?shape.style.x+dx-detailSize<=this._location.x?shape.style.x=this._location.x+detailSize:shape.style.x+dx+shape.style.width+detailSize>=this._location.x+this._location.width?shape.style.x=this._location.x+this._location.width-shape.style.width-detailSize:shape.style.x+=dx:shape.style.y+dy-detailSize<=this._location.y?shape.style.y=this._location.y+detailSize:shape.style.y+dy+shape.style.height+detailSize>=this._location.y+this._location.height?shape.style.y=this._location.y+this._location.height-shape.style.height-detailSize:shape.style.y+=dy;"filler"==shape._type?this._syncHandleShape():this._syncFillerShape();this.zoomOption.realtime&&this._syncData();if(this.zoomOption.showDetail){var detail=this._getDetail();this._startShape.style.text=this._startShape.highlightStyle.text=detail.start;this._endShape.style.text=this._endShape.highlightStyle.text=detail.end;this._startShape.style.textPosition=this._startShape.highlightStyle.textPosition;this._endShape.style.textPosition=this._endShape.highlightStyle.textPosition}return!0},__ondragend:function(){if(this.zoomOption.showDetail){this._startShape.style.text=this._endShape.style.text="=";this._startShape.style.textPosition=this._endShape.style.textPosition="inside";this.zr.modShape(this._startShape.id);this.zr.modShape(this._endShape.id);this.zr.refreshNextFrame()}this.isDragend=!0},ondragend:function(param,status){if(this.isDragend&&param.target){!this.zoomOption.realtime&&this._syncData();status.dragOut=!0;status.dragIn=!0;this._isSilence||this.zoomOption.realtime||this.messageCenter.dispatch(ecConfig.EVENT.DATA_ZOOM,null,{zoom:this._zoom},this.myChart);status.needRefresh=!1;this.isDragend=!1}},ondataZoom:function(param,status){status.needRefresh=!0},absoluteZoom:function(param){this._zoom.start=param.start;this._zoom.end=param.end;this._zoom.start2=param.start2;this._zoom.end2=param.end2;this._syncShape();this._syncData(!0)},rectZoom:function(param){if(!param){this._zoom.start=this._zoom.start2=0;this._zoom.end=this._zoom.end2=100;this._syncShape();this._syncData(!0);return this._zoom}var gridArea=this.component.grid.getArea(),rect={x:param.x,y:param.y,width:param.width,height:param.height};if(rect.width<0){rect.x+=rect.width;rect.width=-rect.width}if(rect.height<0){rect.y+=rect.height;rect.height=-rect.height}if(rect.x>gridArea.x+gridArea.width||rect.y>gridArea.y+gridArea.height)return!1;rect.x<gridArea.x&&(rect.x=gridArea.x);rect.x+rect.width>gridArea.x+gridArea.width&&(rect.width=gridArea.x+gridArea.width-rect.x);rect.y+rect.height>gridArea.y+gridArea.height&&(rect.height=gridArea.y+gridArea.height-rect.y);var total,sdx=(rect.x-gridArea.x)/gridArea.width,edx=1-(rect.x+rect.width-gridArea.x)/gridArea.width,sdy=1-(rect.y+rect.height-gridArea.y)/gridArea.height,edy=(rect.y-gridArea.y)/gridArea.height;if("horizontal"==this.zoomOption.orient){total=this._zoom.end-this._zoom.start;this._zoom.start+=total*sdx;this._zoom.end-=total*edx;total=this._zoom.end2-this._zoom.start2;this._zoom.start2+=total*sdy;this._zoom.end2-=total*edy}else{total=this._zoom.end-this._zoom.start;this._zoom.start+=total*sdy;this._zoom.end-=total*edy;total=this._zoom.end2-this._zoom.start2;this._zoom.start2+=total*sdx;this._zoom.end2-=total*edx}this._syncShape();this._syncData(!0);return this._zoom},syncBackupData:function(curOption){for(var start,curData,target=this._originalData.series,curSeries=curOption.series,i=0,l=curSeries.length;l>i;i++){curData=curSeries[i].data||curSeries[i].eventList;start=target[i]?Math.floor(this._zoom.start/100*target[i].length):0;for(var j=0,k=curData.length;k>j;j++)target[i]&&(target[i][j+start]=curData[j])}},syncOption:function(magicOption){this.silence(!0);this.option=magicOption;this.option.dataZoom=this.reformOption(this.option.dataZoom);this.zoomOption=this.option.dataZoom;this.myChart.canvasSupported||(this.zoomOption.realtime=!1);this.clear();this._location=this._getLocation();this._zoom=this._getZoom();this._backupData();this.option.dataZoom&&this.option.dataZoom.show&&this._buildShape();this._syncData();this.silence(!1)},silence:function(s){this._isSilence=s},getRealDataIndex:function(sIdx,dIdx){if(!this._originalData||0===this._zoom.start&&100==this._zoom.end)return dIdx;var sreies=this._originalData.series;return sreies[sIdx]?Math.floor(this._zoom.start/100*sreies[sIdx].length)+dIdx:-1},resize:function(){this.clear();this._location=this._getLocation();this._zoom=this._getZoom();this.option.dataZoom.show&&this._buildShape()}};zrUtil.inherits(DataZoom,Base);require("../component").define("dataZoom",DataZoom);return DataZoom});