define(["require","./base","zrender/shape/Rectangle","zrender/shape/Sector","zrender/shape/Circle","../config","zrender/tool/util","zrender/tool/color","zrender/tool/event","../component"],function(require){function RoamController(ecTheme,messageCenter,zr,option,myChart){this.rcOption={};if(option.roamController&&option.roamController.show)if(option.roamController.mapTypeControl){Base.call(this,ecTheme,messageCenter,zr,option,myChart);this.rcOption=option.roamController;var self=this;this._drictionMouseDown=function(params){return self.__drictionMouseDown(params)};this._drictionMouseUp=function(params){return self.__drictionMouseUp(params)};this._drictionMouseMove=function(params){return self.__drictionMouseMove(params)};this._drictionMouseOut=function(params){return self.__drictionMouseOut(params)};this._scaleHandler=function(params){return self.__scaleHandler(params)};this.refresh(option)}else console.error("option.roamController.mapTypeControl has not been defined.")}var Base=require("./base"),RectangleShape=require("zrender/shape/Rectangle"),SectorShape=require("zrender/shape/Sector"),CircleShape=require("zrender/shape/Circle"),ecConfig=require("../config");ecConfig.roamController={zlevel:0,z:4,show:!0,x:"left",y:"top",width:80,height:120,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,handleColor:"#6495ed",fillerColor:"#fff",step:15,mapTypeControl:null};var zrUtil=require("zrender/tool/util"),zrColor=require("zrender/tool/color"),zrEvent=require("zrender/tool/event");RoamController.prototype={type:ecConfig.COMPONENT_TYPE_ROAMCONTROLLER,_buildShape:function(){if(this.rcOption.show){this._itemGroupLocation=this._getItemGroupLocation();this._buildBackground();this._buildItem();for(var i=0,l=this.shapeList.length;l>i;i++)this.zr.addShape(this.shapeList[i])}},_buildItem:function(){this.shapeList.push(this._getDirectionShape("up"));this.shapeList.push(this._getDirectionShape("down"));this.shapeList.push(this._getDirectionShape("left"));this.shapeList.push(this._getDirectionShape("right"));this.shapeList.push(this._getScaleShape("scaleUp"));this.shapeList.push(this._getScaleShape("scaleDown"))},_getDirectionShape:function(direction){var r=this._itemGroupLocation.r,x=this._itemGroupLocation.x+r,y=this._itemGroupLocation.y+r,sectorShape={zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:x,y:y,r:r,startAngle:-45,endAngle:45,color:this.rcOption.handleColor,text:">",textX:x+r/2+4,textY:y-.5,textAlign:"center",textBaseline:"middle",textPosition:"specific",textColor:this.rcOption.fillerColor,textFont:Math.floor(r/2)+"px arial"},highlightStyle:{color:zrColor.lift(this.rcOption.handleColor,-.2),brushType:"fill"},clickable:!0};switch(direction){case"up":sectorShape.rotation=[Math.PI/2,x,y];break;case"left":sectorShape.rotation=[Math.PI,x,y];break;case"down":sectorShape.rotation=[-Math.PI/2,x,y]}sectorShape=new SectorShape(sectorShape);sectorShape._roamType=direction;sectorShape.onmousedown=this._drictionMouseDown;sectorShape.onmouseup=this._drictionMouseUp;sectorShape.onmousemove=this._drictionMouseMove;sectorShape.onmouseout=this._drictionMouseOut;return sectorShape},_getScaleShape:function(text){var width=this._itemGroupLocation.width,height=this._itemGroupLocation.height-width;height=0>height?20:height;var r=Math.min(width/2-5,height)/2,x=this._itemGroupLocation.x+("scaleDown"===text?width-r:r),y=this._itemGroupLocation.y+this._itemGroupLocation.height-r,scaleShape={zlevel:this.getZlevelBase(),z:this.getZBase(),style:{x:x,y:y,r:r,color:this.rcOption.handleColor,text:"scaleDown"===text?"-":"+",textX:x,textY:y-2,textAlign:"center",textBaseline:"middle",textPosition:"specific",textColor:this.rcOption.fillerColor,textFont:Math.floor(r)+"px verdana"},highlightStyle:{color:zrColor.lift(this.rcOption.handleColor,-.2),brushType:"fill"},clickable:!0};scaleShape=new CircleShape(scaleShape);scaleShape._roamType=text;scaleShape.onmousedown=this._scaleHandler;return scaleShape},_buildBackground:function(){var padding=this.reformCssArray(this.rcOption.padding);this.shapeList.push(new RectangleShape({zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:this._itemGroupLocation.x-padding[3],y:this._itemGroupLocation.y-padding[0],width:this._itemGroupLocation.width+padding[3]+padding[1],height:this._itemGroupLocation.height+padding[0]+padding[2],brushType:0===this.rcOption.borderWidth?"fill":"both",color:this.rcOption.backgroundColor,strokeColor:this.rcOption.borderColor,lineWidth:this.rcOption.borderWidth}}))},_getItemGroupLocation:function(){var x,padding=this.reformCssArray(this.rcOption.padding),width=this.rcOption.width,height=this.rcOption.height,zrWidth=this.zr.getWidth(),zrHeight=this.zr.getHeight();switch(this.rcOption.x){case"center":x=Math.floor((zrWidth-width)/2);break;case"left":x=padding[3]+this.rcOption.borderWidth;break;case"right":x=zrWidth-width-padding[1]-padding[3]-2*this.rcOption.borderWidth;break;default:x=this.parsePercent(this.rcOption.x,zrWidth)}var y;switch(this.rcOption.y){case"top":y=padding[0]+this.rcOption.borderWidth;break;case"bottom":y=zrHeight-height-padding[0]-padding[2]-2*this.rcOption.borderWidth;break;case"center":y=Math.floor((zrHeight-height)/2);break;default:y=this.parsePercent(this.rcOption.y,zrHeight)}return{x:x,y:y,r:width/2,width:width,height:height}},__drictionMouseDown:function(params){this.mousedown=!0;this._drictionHandlerOn(params)},__drictionMouseUp:function(params){this.mousedown=!1;this._drictionHandlerOff(params)},__drictionMouseMove:function(params){this.mousedown&&this._drictionHandlerOn(params)},__drictionMouseOut:function(params){this._drictionHandlerOff(params)},_drictionHandlerOn:function(params){this._dispatchEvent(params.event,params.target._roamType);clearInterval(this.dircetionTimer);var self=this;this.dircetionTimer=setInterval(function(){self._dispatchEvent(params.event,params.target._roamType)},100);zrEvent.stop(params.event)},_drictionHandlerOff:function(params){clearInterval(this.dircetionTimer)},__scaleHandler:function(params){this._dispatchEvent(params.event,params.target._roamType);zrEvent.stop(params.event)},_dispatchEvent:function(event,roamType){this.messageCenter.dispatch(ecConfig.EVENT.ROAMCONTROLLER,event,{roamType:roamType,mapTypeControl:this.rcOption.mapTypeControl,step:this.rcOption.step},this.myChart)},refresh:function(newOption){if(newOption){this.option=newOption||this.option;this.option.roamController=this.reformOption(this.option.roamController);this.rcOption=this.option.roamController}this.clear();this._buildShape()}};zrUtil.inherits(RoamController,Base);require("../component").define("roamController",RoamController);return RoamController});