define(["require","./base","zrender/shape/Text","zrender/shape/Line","zrender/shape/Rectangle","../config","zrender/tool/util","zrender/tool/area","../component"],function(require){function CategoryAxis(ecTheme,messageCenter,zr,option,myChart,axisBase){if(option.data.length<1)console.error("option.data.length < 1.");else{Base.call(this,ecTheme,messageCenter,zr,option,myChart);this.grid=this.component.grid;for(var method in axisBase)this[method]=axisBase[method];this.refresh(option)}}var Base=require("./base"),TextShape=require("zrender/shape/Text"),LineShape=require("zrender/shape/Line"),RectangleShape=require("zrender/shape/Rectangle"),ecConfig=require("../config");ecConfig.categoryAxis={zlevel:0,z:0,show:!0,position:"bottom",name:"",nameLocation:"end",nameTextStyle:{},boundaryGap:!0,axisLine:{show:!0,onZero:!0,lineStyle:{color:"#48b",width:2,type:"solid"}},axisTick:{show:!0,interval:"auto",inside:!1,length:5,lineStyle:{color:"#333",width:1}},axisLabel:{show:!0,interval:"auto",rotate:0,margin:8,textStyle:{color:"#333"}},splitLine:{show:!0,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}};var zrUtil=require("zrender/tool/util"),zrArea=require("zrender/tool/area");CategoryAxis.prototype={type:ecConfig.COMPONENT_TYPE_AXIS_CATEGORY,_getReformedLabel:function(idx){var data=this.getDataFromOption(this.option.data[idx]),formatter=this.option.data[idx].formatter||this.option.axisLabel.formatter;formatter&&("function"==typeof formatter?data=formatter.call(this.myChart,data):"string"==typeof formatter&&(data=formatter.replace("{value}",data)));return data},_getInterval:function(){var interval=this.option.axisLabel.interval;if("auto"==interval){var fontSize=this.option.axisLabel.textStyle.fontSize,data=this.option.data,dataLength=this.option.data.length;if(this.isHorizontal())if(dataLength>3){var labelSpace,labelSize,gap=this.getGap(),isEnough=!1,step=Math.floor(.5/gap);step=1>step?1:step;interval=Math.floor(15/gap);for(;!isEnough&&dataLength>interval;){interval+=step;isEnough=!0;labelSpace=Math.floor(gap*interval);for(var i=Math.floor((dataLength-1)/interval)*interval;i>=0;i-=interval){if(0!==this.option.axisLabel.rotate)labelSize=fontSize;else if(data[i].textStyle)labelSize=zrArea.getTextWidth(this._getReformedLabel(i),this.getFont(zrUtil.merge(data[i].textStyle,this.option.axisLabel.textStyle)));else{var label=this._getReformedLabel(i)+"",wLen=(label.match(/\w/g)||"").length,oLen=label.length-wLen;labelSize=wLen*fontSize*2/3+oLen*fontSize}if(labelSize>labelSpace){isEnough=!1;break}}}}else interval=1;else if(dataLength>3){var gap=this.getGap();interval=Math.floor(11/gap);for(;fontSize>gap*interval-6&&dataLength>interval;)interval++}else interval=1}else interval="function"==typeof interval?1:interval-0+1;return interval},_buildShape:function(){this._interval=this._getInterval();if(this.option.show){this.option.splitArea.show&&this._buildSplitArea();this.option.splitLine.show&&this._buildSplitLine();this.option.axisLine.show&&this._buildAxisLine();this.option.axisTick.show&&this._buildAxisTick();this.option.axisLabel.show&&this._buildAxisLabel();for(var i=0,l=this.shapeList.length;l>i;i++)this.zr.addShape(this.shapeList[i])}},_buildAxisTick:function(){var axShape,data=this.option.data,dataLength=this.option.data.length,tickOption=this.option.axisTick,length=tickOption.length,color=tickOption.lineStyle.color,lineWidth=tickOption.lineStyle.width,intervalFunction="function"==typeof tickOption.interval?tickOption.interval:"auto"==tickOption.interval&&"function"==typeof this.option.axisLabel.interval?this.option.axisLabel.interval:!1,interval=intervalFunction?1:"auto"==tickOption.interval?this._interval:tickOption.interval-0+1,onGap=tickOption.onGap,optGap=onGap?this.getGap()/2:"undefined"==typeof onGap&&this.option.boundaryGap?this.getGap()/2:0,startIndex=optGap>0?-interval:0;if(this.isHorizontal()){for(var x,yPosition="bottom"==this.option.position?tickOption.inside?this.grid.getYend()-length-1:this.grid.getYend()+1:tickOption.inside?this.grid.getY()+1:this.grid.getY()-length-1,i=startIndex;dataLength>i;i+=interval)if(!intervalFunction||intervalFunction(i,data[i])){x=this.subPixelOptimize(this.getCoordByIndex(i)+(i>=0?optGap:0),lineWidth);axShape={_axisShape:"axisTick",zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{xStart:x,yStart:yPosition,xEnd:x,yEnd:yPosition+length,strokeColor:color,lineWidth:lineWidth}};this.shapeList.push(new LineShape(axShape))}}else for(var y,xPosition="left"==this.option.position?tickOption.inside?this.grid.getX()+1:this.grid.getX()-length-1:tickOption.inside?this.grid.getXend()-length-1:this.grid.getXend()+1,i=startIndex;dataLength>i;i+=interval)if(!intervalFunction||intervalFunction(i,data[i])){y=this.subPixelOptimize(this.getCoordByIndex(i)-(i>=0?optGap:0),lineWidth);axShape={_axisShape:"axisTick",zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{xStart:xPosition,yStart:y,xEnd:xPosition+length,yEnd:y,strokeColor:color,lineWidth:lineWidth}};this.shapeList.push(new LineShape(axShape))}},_buildAxisLabel:function(){var axShape,dataTextStyle,data=this.option.data,dataLength=this.option.data.length,labelOption=this.option.axisLabel,rotate=labelOption.rotate,margin=labelOption.margin,clickable=labelOption.clickable,textStyle=labelOption.textStyle,intervalFunction="function"==typeof labelOption.interval?labelOption.interval:!1;if(this.isHorizontal()){var yPosition,baseLine;if("bottom"==this.option.position){yPosition=this.grid.getYend()+margin;baseLine="top"}else{yPosition=this.grid.getY()-margin;baseLine="bottom"}for(var i=0;dataLength>i;i+=this._interval)if((!intervalFunction||intervalFunction(i,data[i]))&&""!==this._getReformedLabel(i)){dataTextStyle=zrUtil.merge(data[i].textStyle||{},textStyle);axShape={zlevel:this.getZlevelBase(),z:this.getZBase()+3,hoverable:!1,style:{x:this.getCoordByIndex(i),y:yPosition,color:dataTextStyle.color,text:this._getReformedLabel(i),textFont:this.getFont(dataTextStyle),textAlign:dataTextStyle.align||"center",textBaseline:dataTextStyle.baseline||baseLine}};if(rotate){axShape.style.textAlign=rotate>0?"bottom"==this.option.position?"right":"left":"bottom"==this.option.position?"left":"right";axShape.rotation=[rotate*Math.PI/180,axShape.style.x,axShape.style.y]}this.shapeList.push(new TextShape(this._axisLabelClickable(clickable,axShape)))}}else{var xPosition,align;if("left"==this.option.position){xPosition=this.grid.getX()-margin;align="right"}else{xPosition=this.grid.getXend()+margin;align="left"}for(var i=0;dataLength>i;i+=this._interval)if((!intervalFunction||intervalFunction(i,data[i]))&&""!==this._getReformedLabel(i)){dataTextStyle=zrUtil.merge(data[i].textStyle||{},textStyle);axShape={zlevel:this.getZlevelBase(),z:this.getZBase()+3,hoverable:!1,style:{x:xPosition,y:this.getCoordByIndex(i),color:dataTextStyle.color,text:this._getReformedLabel(i),textFont:this.getFont(dataTextStyle),textAlign:dataTextStyle.align||align,textBaseline:dataTextStyle.baseline||0===i&&""!==this.option.name?"bottom":i==dataLength-1&&""!==this.option.name?"top":"middle"}};rotate&&(axShape.rotation=[rotate*Math.PI/180,axShape.style.x,axShape.style.y]);this.shapeList.push(new TextShape(this._axisLabelClickable(clickable,axShape)))}}},_buildSplitLine:function(){var axShape,data=this.option.data,dataLength=this.option.data.length,sLineOption=this.option.splitLine,lineType=sLineOption.lineStyle.type,lineWidth=sLineOption.lineStyle.width,color=sLineOption.lineStyle.color;color=color instanceof Array?color:[color];var colorLength=color.length,intervalFunction="function"==typeof this.option.axisLabel.interval?this.option.axisLabel.interval:!1,onGap=sLineOption.onGap,optGap=onGap?this.getGap()/2:"undefined"==typeof onGap&&this.option.boundaryGap?this.getGap()/2:0;dataLength-=onGap||"undefined"==typeof onGap&&this.option.boundaryGap?1:0;if(this.isHorizontal()){for(var x,sy=this.grid.getY(),ey=this.grid.getYend(),i=0;dataLength>i;i+=this._interval)if(!intervalFunction||intervalFunction(i,data[i])){x=this.subPixelOptimize(this.getCoordByIndex(i)+optGap,lineWidth);axShape={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{xStart:x,yStart:sy,xEnd:x,yEnd:ey,strokeColor:color[i/this._interval%colorLength],lineType:lineType,lineWidth:lineWidth}};this.shapeList.push(new LineShape(axShape))}}else for(var y,sx=this.grid.getX(),ex=this.grid.getXend(),i=0;dataLength>i;i+=this._interval)if(!intervalFunction||intervalFunction(i,data[i])){y=this.subPixelOptimize(this.getCoordByIndex(i)-optGap,lineWidth);axShape={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{xStart:sx,yStart:y,xEnd:ex,yEnd:y,strokeColor:color[i/this._interval%colorLength],lineType:lineType,lineWidth:lineWidth}};this.shapeList.push(new LineShape(axShape))}},_buildSplitArea:function(){var axShape,data=this.option.data,sAreaOption=this.option.splitArea,color=sAreaOption.areaStyle.color;if(color instanceof Array){var colorLength=color.length,dataLength=this.option.data.length,intervalFunction="function"==typeof this.option.axisLabel.interval?this.option.axisLabel.interval:!1,onGap=sAreaOption.onGap,optGap=onGap?this.getGap()/2:"undefined"==typeof onGap&&this.option.boundaryGap?this.getGap()/2:0;if(this.isHorizontal()){for(var curX,y=this.grid.getY(),height=this.grid.getHeight(),lastX=this.grid.getX(),i=0;dataLength>=i;i+=this._interval)if(!(intervalFunction&&!intervalFunction(i,data[i])&&dataLength>i)){curX=dataLength>i?this.getCoordByIndex(i)+optGap:this.grid.getXend();axShape={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:lastX,y:y,width:curX-lastX,height:height,color:color[i/this._interval%colorLength]}};this.shapeList.push(new RectangleShape(axShape));lastX=curX}}else for(var curY,x=this.grid.getX(),width=this.grid.getWidth(),lastYend=this.grid.getYend(),i=0;dataLength>=i;i+=this._interval)if(!(intervalFunction&&!intervalFunction(i,data[i])&&dataLength>i)){curY=dataLength>i?this.getCoordByIndex(i)-optGap:this.grid.getY();axShape={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:x,y:curY,width:width,height:lastYend-curY,color:color[i/this._interval%colorLength]}};this.shapeList.push(new RectangleShape(axShape));lastYend=curY}}else{axShape={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{x:this.grid.getX(),y:this.grid.getY(),width:this.grid.getWidth(),height:this.grid.getHeight(),color:color}};this.shapeList.push(new RectangleShape(axShape))}},refresh:function(newOption){if(newOption){this.option=this.reformOption(newOption);this.option.axisLabel.textStyle=this.getTextStyle(this.option.axisLabel.textStyle)}this.clear();this._buildShape()},getGap:function(){var dataLength=this.option.data.length,total=this.isHorizontal()?this.grid.getWidth():this.grid.getHeight();return this.option.boundaryGap?total/dataLength:total/(dataLength>1?dataLength-1:1)},getCoord:function(value){for(var data=this.option.data,dataLength=data.length,gap=this.getGap(),position=this.option.boundaryGap?gap/2:0,i=0;dataLength>i;i++){if(this.getDataFromOption(data[i])==value){position=this.isHorizontal()?this.grid.getX()+position:this.grid.getYend()-position;return position}position+=gap}},getCoordByIndex:function(dataIndex){if(0>dataIndex)return this.isHorizontal()?this.grid.getX():this.grid.getYend();if(dataIndex>this.option.data.length-1)return this.isHorizontal()?this.grid.getXend():this.grid.getY();var gap=this.getGap(),position=this.option.boundaryGap?gap/2:0;position+=dataIndex*gap;position=this.isHorizontal()?this.grid.getX()+position:this.grid.getYend()-position;return position},getNameByIndex:function(dataIndex){return this.getDataFromOption(this.option.data[dataIndex])},getIndexByName:function(name){for(var data=this.option.data,dataLength=data.length,i=0;dataLength>i;i++)if(this.getDataFromOption(data[i])==name)return i;return-1},getValueFromCoord:function(){return""},isMainAxis:function(dataIndex){return dataIndex%this._interval===0}};zrUtil.inherits(CategoryAxis,Base);require("../component").define("categoryAxis",CategoryAxis);return CategoryAxis});