define(["topologicalCore"],function(){(topologic.fill1=function(){this.initialize();this.shape=new cjs.Shape;this.shape.graphics.rf(["rgba(255,255,255,0.149)","rgba(255,255,255,0)"],[0,1],0,0,0,0,0,532.9).s().p("Eg6VA6XUgYMgYMAABgiLUgABgiLAYMgYKUAYKgYMAiLAABUAiLgABAYMAYMUAYKAYKAABAiLUgABAiLgYKAYMUgYMAYKgiLAABUgiLgABgYKgYKg");this.addChild(this.shape)}).prototype=p=new cjs.Container;p.nominalBounds=new cjs.Rectangle(-528.2,-528.2,1056.4,1056.4);(topologic.bgAnimation=function(mode,startPosition,loop){this.initialize(mode,startPosition,loop,{});this.instance=new topologic.fill1("synched",0);this.instance.setTransform(-2.4,-2.4);this.timeline.addTween(cjs.Tween.get(this.instance).wait(1).to({scaleX:1,scaleY:1,alpha:.001},0).wait(1).to({scaleX:1,scaleY:1,alpha:.003},0).wait(1).to({scaleX:1,scaleY:1,alpha:.006},0).wait(1).to({scaleX:1.01,scaleY:1.01,alpha:.01},0).wait(1).to({scaleX:1.01,scaleY:1.01,alpha:.015},0).wait(1).to({scaleX:1.01,scaleY:1.01,alpha:.021},0).wait(1).to({scaleX:1.02,scaleY:1.02,alpha:.028},0).wait(1).to({scaleX:1.02,scaleY:1.02,alpha:.036},0).wait(1).to({scaleX:1.03,scaleY:1.03,alpha:.046},0).wait(1).to({scaleX:1.04,scaleY:1.04,alpha:.057},0).wait(1).to({scaleX:1.05,scaleY:1.05,alpha:.07},0).wait(1).to({scaleX:1.05,scaleY:1.05,alpha:.084},0).wait(1).to({scaleX:1.06,scaleY:1.06,alpha:.099},0).wait(1).to({scaleX:1.08,scaleY:1.08,alpha:.117},0).wait(1).to({scaleX:1.09,scaleY:1.09,alpha:.136},0).wait(1).to({scaleX:1.1,scaleY:1.1,alpha:.156},0).wait(1).to({scaleX:1.12,scaleY:1.12,alpha:.179},0).wait(1).to({scaleX:1.13,scaleY:1.13,alpha:.204},0).wait(1).to({scaleX:1.15,scaleY:1.15,alpha:.231},0).wait(1).to({scaleX:1.17,scaleY:1.17,alpha:.26},0).wait(1).to({scaleX:1.19,scaleY:1.19,alpha:.291},0).wait(1).to({scaleX:1.21,scaleY:1.21,alpha:.325},0).wait(1).to({scaleX:1.23,scaleY:1.23,alpha:.361},0).wait(1).to({scaleX:1.25,scaleY:1.25,alpha:.399},0).wait(1).to({scaleX:1.28,scaleY:1.28,alpha:.439},0).wait(1).to({scaleX:1.31,scaleY:1.31,alpha:.481},0).wait(1).to({scaleX:1.34,scaleY:1.34,alpha:.525},0).wait(1).to({scaleX:1.37,scaleY:1.37,alpha:.571},0).wait(1).to({scaleX:1.4,scaleY:1.4,alpha:.617},0).wait(1).to({scaleX:1.42,scaleY:1.42,alpha:.663},0).wait(1).to({scaleX:1.45,scaleY:1.45,alpha:.708},0).wait(1).to({scaleX:1.48,scaleY:1.48,alpha:.753},0).wait(1).to({scaleX:1.51,scaleY:1.51,alpha:.795},0).wait(1).to({scaleX:1.53,scaleY:1.53,alpha:.834},0).wait(1).to({scaleX:1.56,scaleY:1.56,alpha:.87},0).wait(1).to({scaleX:1.58,scaleY:1.58,alpha:.901},0).wait(1).to({scaleX:1.59,scaleY:1.59,alpha:.928},0).wait(1).to({scaleX:1.61,scaleY:1.61,alpha:.951},0).wait(1).to({scaleX:1.62,scaleY:1.62,alpha:.969},0).wait(1).to({scaleX:1.63,scaleY:1.63,alpha:.983},0).wait(1).to({scaleX:1.64,scaleY:1.64,alpha:.993},0).wait(1).to({scaleX:1.64,scaleY:1.64,alpha:.998},0).wait(1).to({scaleX:1.64,scaleY:1.64,alpha:1},0).to({startPosition:0},42).wait(1).to({alpha:.999},0).wait(1).to({scaleX:1.64,scaleY:1.64,alpha:.997},0).wait(1).to({scaleX:1.64,scaleY:1.64,alpha:.993},0).wait(1).to({scaleX:1.63,scaleY:1.63,alpha:.988},0).wait(1).to({scaleX:1.63,scaleY:1.63,alpha:.981},0).wait(1).to({scaleX:1.62,scaleY:1.62,alpha:.972},0).wait(1).to({scaleX:1.62,scaleY:1.62,alpha:.961},0).wait(1).to({scaleX:1.61,scaleY:1.61,alpha:.948},0).wait(1).to({scaleX:1.6,scaleY:1.6,alpha:.934},0).wait(1).to({scaleX:1.59,scaleY:1.59,alpha:.917},0).wait(1).to({scaleX:1.58,scaleY:1.58,alpha:.898},0).wait(1).to({scaleX:1.56,scaleY:1.56,alpha:.878},0).wait(1).to({scaleX:1.55,scaleY:1.55,alpha:.855},0).wait(1).to({scaleX:1.53,scaleY:1.53,alpha:.83},0).wait(1).to({scaleX:1.51,scaleY:1.51,alpha:.803},0).wait(1).to({scaleX:1.5,scaleY:1.5,alpha:.774},0).wait(1).to({scaleX:1.48,scaleY:1.48,alpha:.742},0).wait(1).to({scaleX:1.45,scaleY:1.45,alpha:.709},0).wait(1).to({scaleX:1.43,scaleY:1.43,alpha:.675},0).wait(1).to({scaleX:1.41,scaleY:1.41,alpha:.638},0).wait(1).to({scaleX:1.38,scaleY:1.38,alpha:.601},0).wait(1).to({scaleX:1.36,scaleY:1.36,alpha:.562},0).wait(1).to({scaleX:1.33,scaleY:1.33,alpha:.522},0).wait(1).to({scaleX:1.31,scaleY:1.31,alpha:.483},0).wait(1).to({scaleX:1.28,scaleY:1.28,alpha:.442},0).wait(1).to({scaleX:1.26,scaleY:1.26,alpha:.403},0).wait(1).to({scaleX:1.23,scaleY:1.23,alpha:.364},0).wait(1).to({scaleX:1.21,scaleY:1.21,alpha:.326},0).wait(1).to({scaleX:1.19,scaleY:1.19,alpha:.289},0).wait(1).to({scaleX:1.16,scaleY:1.16,alpha:.254},0).wait(1).to({scaleX:1.14,scaleY:1.14,alpha:.22},0).wait(1).to({scaleX:1.12,scaleY:1.12,alpha:.189},0).wait(1).to({scaleX:1.1,scaleY:1.1,alpha:.16},0).wait(1).to({scaleX:1.09,scaleY:1.09,alpha:.134},0).wait(1).to({scaleX:1.07,scaleY:1.07,alpha:.11},0).wait(1).to({scaleX:1.06,scaleY:1.06,alpha:.088},0).wait(1).to({scaleX:1.04,scaleY:1.04,alpha:.069},0).wait(1).to({scaleX:1.03,scaleY:1.03,alpha:.052},0).wait(1).to({scaleX:1.02,scaleY:1.02,alpha:.038},0).wait(1).to({scaleX:1.02,scaleY:1.02,alpha:.026},0).wait(1).to({scaleX:1.01,scaleY:1.01,alpha:.016},0).wait(1).to({scaleX:1.01,scaleY:1.01,alpha:.009},0).wait(1).to({scaleX:1,scaleY:1,alpha:.004},0).wait(1).to({scaleX:1,scaleY:1,alpha:.001},0).wait(1).to({scaleX:1,scaleY:1,alpha:0},0).wait(48))}).prototype=p=new cjs.MovieClip;p.nominalBounds=new cjs.Rectangle(-530.6,-530.6,1056.4,1056.4);(topologic.TopologicalNode=function(name,icon,nodeParent,nodeChildren){this.initialize();this.nodeWidth=120;this.nodeHeight=135;this.portRadius=3;this.text=new cjs.Text(name||"","15px 黑体","#ffffff");this.text.setTransform(-(15*this.text.text.length-this.nodeWidth)/2,this.nodeHeight-24);var textBackground=new cjs.Bitmap("images/TextBackground.png");textBackground.setTransform(-(15*this.text.text.length-this.nodeWidth)/2-8,this.nodeHeight-30,(15*this.text.text.length+18)/95,.75);this.image=new cjs.Bitmap(icon);if(!name||""===name){this.image.setTransform(0,12);this.image.setBounds(0,12)}this.hitObject=new cjs.Shape;this.hitObject.graphics.beginFill("#000000").drawRect(0,0,this.nodeWidth,this.nodeHeight);this.image.hitArea=this.hitObject;this.toX=0;this.toY=0;this.nodeChildren=nodeChildren;this.nodeParent=nodeParent;this.nodeState="stay";this.SLT=new cjs.Container;var g=new cjs.Graphics;g.beginFill("red");g.drawRect(0,0,this.nodeWidth/15,this.nodeHeight/15);var shape=new cjs.Shape(g);this.SLT.addChildAt(shape,0);this.ports=[{x:this.nodeWidth/6,y:-this.portRadius,link:-1},{x:this.nodeWidth/2,y:-this.portRadius,link:-1},{x:this.nodeWidth/6*5,y:-this.portRadius,link:-1},{x:this.nodeWidth,y:this.nodeHeight/6,link:-1},{x:this.nodeWidth,y:this.nodeHeight/2,link:-1},{x:this.nodeWidth,y:this.nodeHeight/6*5,link:-1},{x:this.nodeWidth/6*5,y:this.nodeHeight+this.portRadius,link:-1},{x:this.nodeWidth/2,y:this.nodeHeight+this.portRadius,link:-1},{x:this.nodeWidth/6,y:this.nodeHeight+this.portRadius,link:-1},{x:-this.portRadius,y:this.nodeHeight/6*5,link:-1},{x:-this.portRadius,y:this.nodeHeight/2,link:-1},{x:-this.portRadius,y:this.nodeHeight/6,link:-1}];this.on("click",function(evt){if(!(Math.abs(this.mcx-evt.stageX)>1||Math.abs(this.mcy-evt.stageY)>1)&&this.nodeChildren&&0!=this.nodeChildren.length){this.collapsed?this.expand():this.collapse();this.collapsed=!this.collapsed}});this.on("pressmove",function(evt){if(!(Math.abs(this.mcx-evt.stageX)<1||Math.abs(this.mcy-evt.stageY)<1)){this.image.cursor="move";this.nodeState="drag";this.toX=evt.stageX+this.offset.x;this.toY=evt.stageY+this.offset.y;this.SLT.x=(evt.stageX+this.offset.x)/10;this.SLT.y=(evt.stageY+this.offset.y)/10}});this.on("mousedown",function(evt){this.mcx=evt.stageX;this.mcy=evt.stageY;this.parent.addChild(this);this.offset={x:this.x-evt.stageX,y:this.y-evt.stageY}});this.on("pressup",function(evt){delete this.mcx;delete this.mcy;this.nodeChildren&&this.nodeChildren.length>0?this.image.cursor="pointer":this.image.cursor="move";this.nodeState="init";topologic.TopologicalNode.pool[this.nodeParent]&&Math.abs(this.x-topologic.TopologicalNode.pool[this.nodeParent].x)<10&&(this.toX=topologic.TopologicalNode.pool[this.nodeParent].x);topologic.TopologicalNode.pool[this.nodeParent]&&Math.abs(this.y-topologic.TopologicalNode.pool[this.nodeParent].y)<10&&(this.toY=topologic.TopologicalNode.pool[this.nodeParent].y)});this.image.on("mouseover",function(){this.setTransform(-12,-13+this.getBounds().y,1.25,1.25)});this.image.on("mouseout",function(){this.setTransform(0,this.getBounds().y,1,1)});this.addChild(this.text,this.image);name&&""!==name&&this.addChild(textBackground);topologic.TopologicalNode.count=topologic.TopologicalNode.count||0;topologic.TopologicalNode.count++;topologic.TopologicalNode.pool||(topologic.TopologicalNode.pool=new Array);this.index=topologic.TopologicalNode.pool.length;topologic.TopologicalNode.pool.push(this)}).prototype=new cjs.Container;topologic.TopologicalNode.prototype.expand=function(){for(var i=0;i<this.nodeChildren.length;i++)topologic.TopologicalNode.pool[this.nodeChildren[i]].show()};topologic.TopologicalNode.prototype.collapse=function(){for(var i=0;i<this.nodeChildren.length;i++)topologic.TopologicalNode.pool[this.nodeChildren[i]].hide()};topologic.TopologicalNode.prototype.show=function(){this.nodeState="show";this.x=topologic.TopologicalNode.pool[this.nodeParent].x;this.y=topologic.TopologicalNode.pool[this.nodeParent].y;this.toX=this.ox;this.toY=this.oy;this.SLT.x=this.toX/10;this.SLT.y=this.toY/10;this.nodeChildren&&this.nodeChildren.length>0&&!this.collapsed&&this.expand()};topologic.TopologicalNode.prototype.hide=function(){this.nodeChildren&&this.nodeChildren.length>0&&!this.collapsed&&this.collapse();this.nodeState="hide";this.ox=this.x;this.oy=this.y;this.toX=topologic.TopologicalNode.pool[this.nodeParent].x;this.toY=topologic.TopologicalNode.pool[this.nodeParent].y;this.SLT.x=this.toX/10;this.SLT.y=this.toY/10};topologic.TopologicalNode.prototype.focus=function(canvasWidth,canvasHeight){var centerX=(topologic.TopologicalNode.pool,canvasWidth/2-this.nodeWidth/2),centerY=canvasHeight/2-this.nodeHeight/2,offsetX=centerX-(this.x+this.parent.x),offsetY=centerY-(this.y+this.parent.y);this.focusX=offsetX;this.focusY=offsetY;this.parent.toX=this.parent.x+offsetX;this.parent.toY=this.parent.y+offsetY};topologic.TopologicalNode.prototype.blur=function(){if(this.focusX){this.parent.toX=this.parent.x-this.focusX;this.parent.toY=this.parent.y-this.focusY}delete this.focusX;delete this.focusY}});